# AWS Amplify Chat Application

This is a real-time chat application built with React and AWS services. It provides features like user authentication, real-time messaging, and chat room management.

## Project Structure

```
chat-app-root/
├── chat-app-frontend/                # Frontend React project
│   ├── public/
│   │   └── index.html
│   ├── src/
│   │   ├── components/
│   │   │   ├── ChatMessage.tsx       # Single chat message component
│   │   │   ├── MessageInput.tsx      # Message input component
│   │   │   └── UserList.tsx          # Online users list component
│   │   ├── auth/
│   │   │   └── AmplifyAuth.tsx       # Authentication UI and logic
│   │   ├── hooks/
│   │   │   └── useChatRoom.ts        # Custom hook for chat room logic
│   │   ├── App.tsx                   # Main application component
│   │   ├── index.tsx                 # Application entry point
│   │   ├── aws-exports.js            # AWS Amplify auto-generated config
│   │   └── react-app-env.d.ts        # TypeScript definitions
│   └── package.json                  # Frontend project dependencies
│
└── chat-app-backend-cdk/             # Backend AWS CDK project
    ├── bin/
    │   └── chat-app-backend.ts       # CDK application entry point
    ├── lib/
    │   └── chat-app-api-stack.ts     # WebSocket API & Lambda Stack definition
    ├── lambda/                       # Lambda function code
    │   └── websocket/                # WebSocket API Lambda functions
    │       ├── connect.ts            # $connect route handler
    │       ├── disconnect.ts         # $disconnect route handler
    │       └── sendMessage.ts        # sendMessage route handler
    ├── lambda-layers/                # Lambda layers
    │   └── common/
    │       └── nodejs/
    │           └── package.json      # Common Lambda layer dependencies
    ├── package.json                  # CDK project dependencies
    ├── tsconfig.json                 # TypeScript configuration
    └── cdk.json                      # CDK configuration
```

## Frontend Setup

### Prerequisites

- Node.js (v14 or later)
- npm or yarn
- AWS account
- AWS Amplify CLI

### Setup Instructions

1. **Install Amplify CLI** (if not already installed):
   ```bash
   npm install -g @aws-amplify/cli
   ```

2. **Configure Amplify CLI**:
   ```bash
   amplify configure
   ```
   Follow the prompts to set up your AWS credentials.

3. **Initialize Amplify in the project**:
   ```bash
   cd chat-app-frontend
   amplify init
   ```
   Follow the prompts to initialize your Amplify project.

4. **Add Authentication**:
   ```bash
   amplify add auth
   ```
   Choose the default configuration or customize as needed.

5. **Add API for chat functionality**:
   ```bash
   amplify add api
   ```
   Select GraphQL, and use the schema provided in the backend setup guide.

6. **Push the configuration to AWS**:
   ```bash
   amplify push
   ```
   This will create the necessary AWS resources and generate the `aws-exports.js` file.

7. **Install frontend dependencies**:
   ```bash
   npm install
   ```

8. **Start the development server**:
   ```bash
   npm start
   ```
   The application will be available at http://localhost:3000

### About aws-exports.js

The `aws-exports.js` file contains the configuration for connecting your frontend to the AWS backend services. This file is automatically generated by the Amplify CLI when you run `amplify push`. It includes information such as:

- API endpoints
- Authentication settings
- PubSub configuration for real-time messaging
- Storage configuration

**Important**: This file should not be manually edited or committed to version control as it contains sensitive information specific to your AWS environment.

## Backend Setup

### Prerequisites

- Node.js (v14 or later)
- AWS CLI configured with appropriate credentials
- AWS CDK installed globally (`npm install -g aws-cdk`)

### Setup Instructions

1. **Navigate to the backend directory**:
   ```bash
   cd chat-app-backend-cdk
   ```

2. **Install dependencies**:
   ```bash
   npm install
   ```

3. **Bootstrap CDK** (if not already done in your AWS account):
   ```bash
   cdk bootstrap
   ```

4. **Build the project**:
   ```bash
   npm run build
   ```

5. **Deploy the stack**:
   ```bash
   cdk deploy
   ```

6. **Note the outputs**:
   After deployment, CDK will output important information like the WebSocket API URL. You'll need this URL to connect from the frontend.

### WebSocket API Usage

The WebSocket API supports the following routes:

- **$connect** - Establishes a WebSocket connection
  - Query parameters:
    - `userId`: User identifier
    - `roomId`: Chat room identifier
    - `username`: Display name for the user

- **$disconnect** - Handles connection termination

- **sendMessage** - Sends a message to a chat room
  - Message format:
    ```json
    {
      "action": "sendMessage",
      "roomId": "room-id",
      "content": "Hello, world!"
    }
    ```

## Features

- User authentication (sign up, sign in, sign out)
- Create and join chat rooms
- Real-time messaging via WebSockets
- Online user presence
- Message history

## Technologies Used

- **Frontend**:
  - React
  - TypeScript
  - AWS Amplify JS libraries
  - AWS Amplify UI components

- **Backend**:
  - AWS CDK (TypeScript)
  - AWS Lambda (Node.js 18.x)
  - Amazon API Gateway (WebSocket API)
  - Amazon DynamoDB
  - AWS IAM

## Cleanup

To remove all resources created by this project:

1. **Delete Amplify resources**:
   ```bash
   cd chat-app-frontend
   amplify delete
   ```

2. **Delete CDK stack**:
   ```bash
   cd chat-app-backend-cdk
   cdk destroy
   ```